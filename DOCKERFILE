FROM mcr.microsoft.com/powershell:latest

# Disable PowerShell telemetry
ENV POWERSHELL_TELEMETRY_OPTOUT=1

# Install required tools for apt-get
RUN apt-get update && apt-get install -y \
    apt-utils \
    gnupg \
    lsb-release

# Copy the extra packages file into the image
COPY extra-packages.txt /tmp/extra-packages.txt

# Install extra packages from extra-packages.txt if the file is not empty
RUN if [ -s /tmp/extra-packages.txt ]; then \
      echo "The following packages are listed in extra-packages.txt:" && \
      cat /tmp/extra-packages.txt && \
      apt-get update && xargs apt-get install -y < /tmp/extra-packages.txt; \
    else \
      echo "No packages listed in extra-packages.txt"; \
    fi

# Set the working directory for your scripts
WORKDIR /scripts

# Copy the entrypoint script
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
